# 运维排查助手 Web界面设计方案 (Streamlit版本)

## 1. 技术架构更新

### 1.1 技术栈变更
- **原方案**: Python tkinter + ttkbootstrap GUI框架
- **新方案**: Python Streamlit Web框架
- **优势**: 开发效率提升90%，界面更专业，调试更简单

### 1.2 Streamlit特性
- **自动生成Web界面**: 无需HTML/CSS/JavaScript知识
- **即时预览**: 代码修改后浏览器自动刷新
- **响应式设计**: 自动适配不同屏幕尺寸
- **丰富组件**: 内置图表、表格、侧边栏等组件
- **交互友好**: 支持按钮、滑块、文件上传等多种交互方式

### 1.3 部署方式
```python
# 安装依赖
pip install streamlit

# 运行应用
streamlit run main.py
```

## 2. 界面布局设计

### 2.1 整体布局设计

```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────┬─────────────────────────────────────┐ │
│ │                     │                                     │ │
│ │ 📋 选择问题现象      │                                     │ │
│ │ [日志引擎启动异常 ▼] │                                     │ │
│ │                     │                                     │ │
│ │ 📍 当前排查路径      │        中间：当前排查进展               │ │
│ │ ◉ 日志引擎启动异常    │        ┌─────────────────────────┐     │ │
│ │ └─ ◉ yarn节点异常    │        │  📋 现象: yarn节点异常     │     │ │
│ │                     │        │                          │     │ │
│ │ [⬆️ 返回上级] [🔄 重置]│        │  HowToCheck: 检查yarn...  │     │ │
│ │                     │        │  优先级: 10  版本: v4.14+ │     │ │
│ │                     │        │  来源: yarn节点异常.yml     │     │ │
│ │                     │        │  完整路径: ...             │     │ │
│ │                     │        └─────────────────────────┘     │ │
│ │                     │                                     │ │
│ └─────────────────────┤                                     │ │
│                       │          右侧：操作区域                │ │
│                       │        ┌─────────────────────────┐     │ │
│                       │        │  ✅ Checklist确认单         │     │ │
│                       │        │                          │     │ │
│                       │        │ 🚫✅ yarn节点相关机器时间不一致│     │ │
│                       │        │    HowToCheck: 检查yarn所有...     │ │ │
│                       │        │    (优先级: 8)             │     │ │
│                       │        │                          │     │ │
│                       │        │ ───────────────────────── │     │ │
│                       │        │                          │     │ │
│                       │        │ 🚫✅ yarn队列资源不足        │     │ │
│                       │        │    描述: 查看yarn队列...     │ │ │
│                       │        │    (优先级: 7)             │     │ │
│                       │        │                          │     │ │
│                       │        └─────────────────────────┘     │ │
│ └─────────────────────┴─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**核心设计特点**:
- **左栏（1.2占比）**: 问题选择 + 导航路径，紧凑布局
- **右栏（2.8占比）**: 检查项详情 + 操作区域，上下分布
- **图标按钮**: 🚫✅ 按钮前置，节省空间，悬浮提示
- **智能切换**: 确认检查项后自动切换为解决方案

#### 示例2: 排除项目后的界面状态
```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────┬─────────────────────────────────────┐ │
│ │                     │                                     │ │
│ │ 📋 选择问题现象      │                                     │ │
│ │ [日志引擎启动异常 ▼] │                                     │ │
│ │                     │                                     │ │
│ │ 📍 当前排查路径      │        中间：当前排查进展               │ │
│ │ ◉ 日志引擎启动异常    │        ┌─────────────────────────┐     │ │
│ │ └─ ◉ yarn节点异常    │        │  📋 现象: yarn节点异常     │     │ │
│ │                     │        │                          │     │ │
│ │ [⬆️ 返回上级] [🔄 重置]│        │  HowToCheck: 检查yarn...  │     │ │
│ │                     │        │  优先级: 10  版本: v4.14+ │     │ │
│ │                     │        │  来源: yarn节点异常.yml     │ │ │
│ │                     │        │  完整路径: ...             │     │ │
│ │                     │        └─────────────────────────┘     │ │
│ │                     │                                     │ │
│ └─────────────────────┤                                     │ │
│                       │          右侧：操作区域                │ │
│                       │        ┌─────────────────────────┐     │ │
│                       │        │  ✅ Checklist确认单         │     │ │
│                       │        │                          │     │ │
│                       │        │  ~~yarn节点相关机器时间不一致~~ │     │ │
│                       │        │    (已排除，优先级: 8)       │     │ │
│                       │        │                          │     │ │
│                       │        │ ───────────────────────── │     │ │
│                       │        │                          │     │ │
│                       │        │ 🚫✅ yarn队列资源不足        │     │ │
│                       │        │    描述: 查看yarn队列...     │ │ │
│                       │        │    (优先级: 7)             │     │ │
│                       │        │                          │     │ │
│                       │        └─────────────────────────┘     │ │
│ └─────────────────────┴─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 示例3: 确认项目后的解决方案界面（含链接）
```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────┬─────────────────────────────────────┐ │
│ │                     │                                     │ │
│ │ 📋 选择问题现象      │                                     │ │
│ │ [日志引擎启动异常 ▼] │                                     │ │
│ │                     │                                     │ │
│ │ 📍 当前排查路径      │        中间：✅ 已确认检查项         │ │
│ │ ◉ 日志引擎启动异常    │        ┌─────────────────────────┐     │ │
│ │ └─ ◉ yarn节点异常    │        │  ✅ 已确认: yarn队列资源不足 │     │ │
│ │   └─ ◉ yarn队列不足  │        │                          │     │ │
│ │                     │        │  优先级: 7                │     │ │
│ │ [⬆️ 返回上级] [🔄 重置]│        │  版本: BaaS-v4.14+        │     │ │
│ │                     │        │  来源: yarn节点异常.yml     │ │ │
│ │                     │        │  完整路径: ...             │     │ │
│ │                     │        └─────────────────────────┘     │ │
│ │                     │                                     │ │
│ └─────────────────────┤                                     │ │
│                       │          右侧：解决方案                │ │
│                       │        ┌─────────────────────────┐     │ │
│                       │        │  🛠️ 解决方案              │     │ │
│                       │        │                          │     │ │
│                       │        │  **操作步骤:**            │     │ │
│                       │        │  1. 登录yarn管理界面        │     │ │
│                       │        │  2. 检查队列资源配置        │     │ │
│                       │        │  3. 调整队列资源分配        │     │ │
│                       │        │  ─────────────────────     │     │ │
│                       │        │                          │     │ │
│                       │        │  📚 相关文档              │     │ │
│                       │        │  🔗 Yarn队列管理指南       │     │ │
│                       │        │  ─────────────────────     │     │ │
│                       │        │                          │     │ │
│                       │        │  🎬 演示视频              │     │ │
│                       │        │  🔗 资源配置演示.gif       │     │ │
│                       │        │  ─────────────────────     │     │ │
│                       │        │                          │     │ │
│                       │        │  📜 相关脚本              │     │ │
│                       │        │  🔗 check_queue.sh        │     │ │
│                       │        │                          │     │ │
│                       │        │  ┌─────────────────────┐ │     │ │
│                       │        │  │     🔙 返回         │ │     │ │
│                       │        │  └─────────────────────┘ │     │ │
│                       │        └─────────────────────────┘     │ │
│ └─────────────────────┴─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 示例4: 引用项目的处理界面
```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────┬─────────────────────────────────────┐ │
│ │                     │                                     │ │
│ │ 📋 选择问题现象      │                                     │ │
│ │ [日志引擎启动异常 ▼] │                                     │ │
│ │                     │                                     │ │
│ │ 📍 当前排查路径      │        中间：✅ 已确认检查项         │ │
│ │ ◉ 日志引擎启动异常    │        ┌─────────────────────────┐     │ │
│ │ └─ ◉ yarn节点异常    │        │  ✅ 已确认: kafka节点异常  │     │ │
│ │   └─ ◉ 引用:kafka节点 │        │  📎 引用自: kafka节点离线.yml│     │ │
│ │                     │        │                          │     │ │
│ │ [⬆️ 返回上级] [🔄 重置]│        │  优先级: 8                │     │ │
│ │                     │        │  版本: BaaS-v4.14+        │     │ │
│ │                     │        └─────────────────────────┘     │ │
│ │                     │                                     │ │
│ └─────────────────────┤                                     │ │
│                       │          右侧：被引用项目检查列表        │ │
│                       │        ┌─────────────────────────┐     │ │
│                       │        │  ✅ Checklist确认单         │     │ │
│                       │        │                          │     │ │
│                       │        │ 🚫✅ broker节点宕机         │     │ │
│                       │        │    描述: 检查kafka集群...     │ │ │
│                       │        │    (优先级: 9)             │     │ │
│                       │        │                          │     │ │
│                       │        │ ───────────────────────── │     │ │
│                       │        │                          │     │ │
│                       │        │ 🚫✅ 网络连接异常            │     │ │
│                       │        │    描述: 检查网络连通性...     │ │ │
│                       │        │    (优先级: 6)             │     │ │
│                       │        └─────────────────────────┘     │ │
│ └─────────────────────┴─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**界面状态说明**:
- **示例1**: 正常排查状态，显示当前层级的所有检查项
- **示例2**: 排除项目后，被排除项显示删除线和灰色样式，按钮禁用
- **示例3**: 确认项目后自动切换到解决方案，显示详细操作步骤、相关链接（Wiki文档、演示视频、脚本文件）和返回按钮
  - 📚 相关文档：Wiki文档链接，点击可查看详细操作指南
  - 🎬 演示视频：GIF演示图链接，点击可观看操作演示
  - 📜 相关脚本：脚本文件链接，点击可下载或查看自动化脚本
  - 所有URL自动解码显示中文，提升可读性
- **示例4**: 确认引用项目后，显示被引用项目的子检查项列表，支持知识网络构建

### 2.2 界面组件详细说明

#### 2.2.1 左侧面板 (1.2占比) - 导航与选择区域

**问题选择组件**:
- **📋 选择问题现象**: 下拉框显示所有yml文档的一级status标题
- **紧凑设计**: 小字体，减少空间占用
- **即时加载**: 选择后立即加载对应yml文档的完整内容

**当前排查路径组件**:
- **📍 当前排查路径**: 完整显示从问题到当前检查项的路径
- **树状层级结构**:
  - 根节点直接显示名称（如：◉ 日志引擎启动异常）
  - 子节点使用"└─ "前缀显示层级关系
  - 当前节点用◉高亮，上级节点可点击跳转
- **导航按钮**:
  - **⬆️ 返回上级**: 返回上一层级
  - **🔄 重置**: 清除所有进度，重新开始排查

**功能特点**:
- **快速定位**: 点击路径任意节点快速跳转
- **路径追踪**: 实时显示排查进展和当前位置
- **紧凑布局**: 上下分布，空间利用率高

#### 2.2.2 右侧面板 (2.8占比) - 内容与操作区域

**中间：当前排查进展 (上下分布，上部分)**

**智能内容切换**:
- **无确认项目时**: 显示当前导航位置的检查项详情
- **有确认项目时**: 显示已确认项目的详细信息，标题变为"✅ 已确认检查项"

**信息展示**:
- **统一显示格式**: 问题现象和检查项使用相同的展示结构
- **基本信息**:
  - 📁 问题现象 / 🔍 检查项 (根据层级显示不同图标)
  - 状态标题、描述内容
  - 优先级、版本信息（使用metric组件展示）
- **来源信息**:
  - 📄 来源文件名
  - 📎 引用关系（如果有）
  - 📍 完整路径导航
- **统计信息**: 包含的子检查项数量（如果有）

**右侧：操作区域 (上下分布，下部分)**

**智能状态切换**:
- **无确认项目**: 显示当前层级的checklist确认列表
- **普通项目确认**: 自动切换为解决方案展示
- **引用项目确认**: 显示被引用项目的子检查项列表

**Checklist确认单面板**:
- **✅ Checklist确认单**: 紧凑标题设计
- **图标按钮前置**:
  - 🚫 排除按钮 (红色，悬浮提示"标记此原因已被排除")
  - ✅ 确认按钮 (绿色，悬浮提示"确认此原因存在")
- **卡片式布局**:
  - 未排除：白色背景 + 红色左边框 + hover效果
  - 已排除：灰色背景 + 灰色边框 + 删除线样式
- **信息展示**:
  - 检查项状态 (优先级)
  - 描述内容
- **排序方式**: 按priority降序自动排序

**解决方案面板**:
- **🛠️ 解决方案**: 清晰的标题标识
- **操作步骤展示**:
  - 结构化显示步骤编号
  - 支持多种格式（数字编号、项目符号等）
- **返回按钮**: 🔙 返回按钮，回到checklist列表继续排查

**引用项目处理**:
- **特殊标识**: 显示📎引用来源信息
- **智能加载**: 确认后自动加载被引用项目的子检查项
- **知识网络**: 支持问题间的相互引用，避免重复维护

**响应式交互特性**:
- **紧凑设计**: 小字体、窄边距、高信息密度
- **悬浮提示**: 所有图标按钮都有详细的悬浮说明
- **视觉反馈**: 排除项目立即显示删除线和灰色样式
- **状态管理**: 按钮根据排除状态自动启用/禁用
- **无缝切换**: 确认项目后内容区域智能切换，无闪烁

### 2.3 交互流程设计

#### 2.3.1 核心交互流程

**1. 问题选择流程**:
```
启动应用 → 左侧选择问题现象 → 立即显示问题详情 → 显示第一层检查项
```

**2. 排查确认流程**:
```
查看检查项 → 🚫排除 或 ✅确认 → 智能内容切换 → 路径自动更新
```

**3. 智能切换逻辑**:
```
确认普通项目 → 自动显示解决方案 → 🔙返回继续排查
确认引用项目 → 显示被引用项目的子检查项 → 继续排查引用内容
```

#### 2.3.2 状态管理流程

**导航状态**:
- 路径自动跟踪：每次操作都更新左侧导航路径
- 快速跳转：点击路径任意节点立即跳转
- 层级管理：支持多层级嵌套的复杂排查逻辑

**确认状态**:
- 项目确认：立即更新详情面板显示已确认项目信息
- 排除状态：实时更新视觉效果（删除线、灰色背景）
- 按钮状态：根据项目状态自动启用/禁用操作按钮

#### 2.3.3 组件交互映射

| 功能需求 | Streamlit组件 | 实现特点 |
|---------|--------------|---------|
| 问题选择 | `st.selectbox()` | 紧凑设计，即时加载 |
| 排除操作 | `st.button("🚫")` | 图标按钮，悬浮提示 |
| 确认操作 | `st.button("✅")` | 图标按钮，智能切换 |
| 详情显示 | `st.markdown()` + CSS | 自定义紧凑样式 |
| 路径导航 | `st.button()` | 可点击跳转的面包屑 |
| 度量信息 | `st.metric()` | 优先级和版本信息 |
| 状态反馈 | `st.success()` | 操作结果提示 |

### 2.4 样式设计规范

#### 2.4.1 紧凑布局原则
- **字体大小**: 0.9em (主体内容), 0.85em (辅助信息)
- **间距控制**: padding: 8px (卡片), margin: 3px (间距)
- **高度控制**: 最小化垂直空间占用

#### 2.4.2 颜色方案
- **未排除项目**: 白色背景 + #FF6B6B红色左边框
- **已排除项目**: #f0f0f0灰色背景 + #999灰色边框
- **悬浮效果**: #f8f9fa浅灰背景 + 鼠标指针

#### 2.4.3 图标系统
- **导航图标**: 📋 (选择), 📍 (路径), ⬆️ (返回), 🔄 (重置)
- **操作图标**: 🚫 (排除), ✅ (确认), 🔙 (返回)
- **信息图标**: 🔍 (检查), 📁 (问题), 📎 (引用), 📄 (来源)

## 3. 响应式适配设计

### 3.1 断点设置
- **桌面端** (>= 1200px): 完整两栏布局 (1.2:2.8比例)
- **平板端** (768px - 1199px): 垂直堆叠布局，左右分栏变上下分布
- **移动端** (< 768px): 单列布局，组件垂直排列

### 3.2 适配策略
- **字体缩放**: 移动端适当增大字体保证可读性
- **按钮间距**: 移动端增大按钮间距避免误触
- **导航简化**: 移动端简化路径导航显示

## 4. 性能优化策略

### 4.1 数据加载优化
- **预加载策略**: 应用启动时一次性加载所有yml数据
- **内存缓存**: 避免重复文件读取操作
- **状态管理**: 使用session_state持久化用户操作状态

### 4.2 渲染优化
- **按需渲染**: 只渲染当前可见区域的内容
- **状态缓存**: 缓存排除状态和确认状态
- **增量更新**: 操作后只更新变化的部分

## 5. 可访问性设计

### 5.1 键盘导航支持
- **Tab键顺序**: 合理的tab导航顺序
- **快捷键支持**: 常用操作的键盘快捷方式
- **焦点管理**: 清晰的焦点指示器

### 5.2 视觉辅助
- **高对比度**: 确保足够的颜色对比度
- **图标替代**: 重要操作不仅有图标还有文字说明
- **状态反馈**: 清晰的操作成功/失败反馈

## 6. 用户体验亮点

### 6.1 智能交互设计
- **零学习成本**: 直观的图标和操作方式
- **即时反馈**: 每个操作都有立即的视觉反馈
- **智能引导**: 自动切换内容，减少用户思考负担

### 6.2 效率优化设计
- **一键操作**: 排除和确认都是一键完成
- **快速导航**: 点击路径任意位置快速跳转
- **批量处理**: 支持快速排除多个项目

### 6.3 容错设计
- **误操作防护**: 排除后可以继续操作其他项目
- **状态恢复**: 重置功能一键恢复到初始状态
- **路径保护**: 任何时候都能清楚地知道当前位置

这个Web界面设计方案完全基于当前的实际实现效果，准确反映了应用的交互逻辑、视觉设计和用户体验特点。通过Streamlit框架的现代化Web技术，实现了比传统GUI更高效、更直观的运维排查体验。
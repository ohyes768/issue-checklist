# 运维排查助手 Web界面设计方案 (Streamlit版本)

## 1. 技术架构更新

### 1.1 技术栈变更
- **原方案**: Python tkinter + ttkbootstrap GUI框架
- **新方案**: Python Streamlit Web框架
- **优势**: 开发效率提升90%，界面更专业，调试更简单

### 1.2 Streamlit特性
- **自动生成Web界面**: 无需HTML/CSS/JavaScript知识
- **即时预览**: 代码修改后浏览器自动刷新
- **响应式设计**: 自动适配不同屏幕尺寸
- **丰富组件**: 内置图表、表格、侧边栏等组件
- **交互友好**: 支持按钮、滑块、文件上传等多种交互方式

### 1.3 部署方式
```python
# 安装依赖
pip install streamlit

# 运行应用
streamlit run src/web_app.py
```

## 2. 界面布局设计

### 2.1 整体布局设计

```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ 📋 选择问题现象: [日志引擎启动异常 ▼]  🔄 重置  🏠 首页      │
├─────────────────────────────────────────────────────────────┤
│ ┌───────────┬─────────────────────┬─────────────────────┐   │
│ │           │                     │                     │   │
│ │ 当前排查路径 │    当前检查项详情        │   Checklist确认面板     │   │
│ │           │                     │                     │   │
│ │ 日志引擎   │ ┌─────────────────┐   │ ┌─────────────────┐   │
│ │ 启动异常   │ │ 🔍 检查项详情    │   │ │ █████ yarn节点   │   │
│ │ └─ yarn节点 │ │                     │   │ │ █ (优先级:10)   │   │
│ │   异常     │ │ 优先级: 10     │   │ │ █ 描述:         │   │
│ │           │ │ 完整路径: ...  │   │ │ █ [排除] [确认]  │   │
│ │           │ └─────────────────┘   │ └─────────────────┘   │
│ │           │ └─────────────────┘   │ └─────────────────┘   │
│ │           │                     │                     │   │
│ └───────────┴─────────────────────┴─────────────────────┘   │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐   │
│ │                  解决方案面板（当有解决方案时）              │   │
│ │ ┌─────────────────────────────────────────────────────┐ │   │
│ │ │ 🛠️ 解决方案: 运维账号登录flink监控页面，修改引擎slots数目 │ │   │
│ │ │                                                         │ │   │
│ │ │ **操作步骤:**                                         │ │   │
│ │ │ 1. 登录flink监控页面                                   │ │   │
│ │ │ 2. 修改引擎slots数目                                   │ │   │
│ │ │ 3. 重新启动引擎                                         │ │   │
│ │ └─────────────────────────────────────────────────────┘ │   │
│ └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

**说明**:
- 所有checklist项直接显示，无需展开
- 卡片式布局，每个检查项独立显示
- 每项下方固定的"排除"、"确认"按钮

#### 示例2: 排除后的界面状态
```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ 现象筛选: [日志引擎启动异常 ▼] [重置]                      │
├─────────────┬───────────────────────────────────────────────┤
│             │                                               │
│ 当前排查路径  │              当前问题详情                        │
│             │ ┌─────────────────────────────────────────┐   │
│ 日志引擎     │ │ 现象: 流任务启动时提示错误信息...       │   │
│ └─ 流任务启动错误│ │ 描述: 点击日志/告警引擎 启动/重启，提示  │   │
│    └─ ◉ yarn节点异常│ │     流任务kafka节点预期不符，yarn节点... │   │
│             │ │ 优先级: 5  版本: BaaS-v4.14+          │   │
│             │ │ 上级: 日志引擎启动异常                 │   │
│             │ └─────────────────────────────────────────┘   │
│             │                                               │
│             │              Checklist确认面板                │
│             │ ┌─────────────────────────────────────────┐   │
│             │ │ (已排除) yarn节点异常 (优先级:10)        │   │
│             │ │ 描述:                                │   │
│             │ │ [排除█] [确认█]                        │   │
│             │ └─────────────────────────────────────────┘   │
│             │ ┌─────────────────────────────────────────┐   │
│             │ │ ┌──────── kafka集群/topic存在异常(8) ─┐ │   │
│             │ │ │ 描述: 流计算任务日志kafka topic错误    │ │   │
│             │ │ │ [排除] [确认]                         │ │   │
│             │ │ └─────────────────────────────────────┘ │   │
│             │ └─────────────────────────────────────────┘   │
│             │                                               │
└─────────────┴───────────────────────────────────────────────┘
```

#### 示例3: 无checklist的界面状态（叶子节点）
```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ 现象筛选: [日志引擎启动异常 ▼] [重置]                      │
├─────────────┬───────────────────────────────────────────────┤
│             │                                               │
│ 当前排查路径  │              当前问题详情                        │
│             │ ┌─────────────────────────────────────────┐   │
│ 日志引擎     │ │ 现象: yarn节点所在磁盘占用>90%         │   │
│ └─ 流任务启动错误│ │ 描述: 各个节点宿主机df -h查看磁盘占用    │   │
│    └─ yarn节点 │ │ 优先级: 9  版本: -                    │   │
│       └─ ◉ 磁盘占用│ │ 上级: 日志引擎启动异常 → 流任务启动错误 │   │
│             │ └─────────────────────────────────────────┘   │
│             │                                               │
│             │              Checklist确认面板                │
│             │ ┌─────────────────────────────────────────┐   │
│             │ │ 无                                     │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ └─────────────────────────────────────────┘   │
│             │ ┌─────────────────────────────────────────┐   │
│             │ │ 解决方案:                                │   │
│             │ │ 删除历史数据、清理日志文件、减小kafka... │   │
│             │ │                                         │   │
│             │ │ 操作步骤:                                │   │
│             │ │ 1. 登录各个yarn节点宿主机               │   │
│             │ │ 2. 执行df -h命令查看磁盘占用            │   │
│             │ │ 3. 清理不必要的日志文件                 │   │
│             │ │ 4. 减小kafka默认留存时间                 │   │
│             │ │ 5. 释放磁盘空间                         │   │
│             │ └─────────────────────────────────────────┘   │
│             │                                               │
└─────────────┴───────────────────────────────────────────────┘
```

**说明**:
- **示例1**: 展示当前问题有checklist的状态，所有检查项直接显示，每个都有固定的"排除"、"确认"按钮
- **示例2**: 展示排除"yarn节点异常"后的状态：
  - 被排除的项目显示删除线效果，按钮变为禁用状态
  - 其他项目保持正常显示和操作状态
- **示例3**: 展示叶子节点的状态：
  - Checklist确认面板显示"无"（因为没有子checklist）
  - 下方显示该检查项的解决方案和操作步骤

### 2.2 界面组件详细说明

#### 2.2.1 顶部工具栏
- **问题选择下拉框**: 显示yml文档一级status标题，支持下拉选择
- **重置按钮**: 清除当前排查进度，重新开始
- **首页按钮**: 快速返回到当前问题的根节点

**功能说明**:
- 下拉框只显示yml文档的顶级status标题（一级问题现象）
- 例如："日志引擎启动异常"、"yarn节点异常"、"kafka节点离线"
- 选择后加载对应yml文档的完整内容和checklist
- 重置功能清除所有进度，返回初始状态
- 首页功能允许在任何层级快速返回当前问题的根节点，方便重新开始排查

#### 2.2.2 左侧当前排查路径面板 (宽度25%)
- **路径导航**: 显示从开始问题到当前排查节点的完整路径
- **统一显示**: 所有路径项都使用ChecklistItem的status名称，不区分类型
- **树状结构**:
  - 根节点：直接显示名称，点击可快速跳转
  - 上级节点：使用"└─ "前缀显示层级关系，点击可快速跳转
  - 当前节点：◉ 高亮显示，保持层级缩进
  - 层级深度：通过缩进符号数量显示树的层级结构

**功能说明**:
- **树状导航**: 清晰的层级结构显示，便于理解排查路径
- **快速跳转**: 点击上级节点可快速返回之前的排查步骤
- **路径跟踪**: 实时显示排查进展，帮助理解排查逻辑
- **统一显示**: 所有节点都是ChecklistItem，不使用类型emoji区分（如📁、📎等）

#### 2.2.3 右上当前检查项详情面板 (高度30%)
- **动态显示内容**:
  - **根节点状态**: 显示选中问题的整体信息（问题现象、问题描述、优先级、版本）
  - **检查项状态**: 显示当前检查项的详细信息（检查项状态、描述、优先级、版本、来源文件）

- **详细信息**:
  - **根节点**: 问题现象、问题描述、问题优先级、影响版本、来源文件
  - **检查项**: 检查项状态、详细描述、优先级、版本范围、来源文件、完整路径
  - **引用信息**: 如果是引用项，显示引用来源和父级引用关系
  - **解决方案预览**: 有解决方案的检查项显示展开预览

**功能说明**:
- 根据用户当前所在层级动态显示相关信息
- 根节点显示问题的整体概况，检查项状态显示具体的检查细节
- 提供完整的数据追溯（来源文件、路径信息）
- 支持解决方案的预览功能，方便快速了解处理方法
- 基于priority提供排查重要性指导

#### 2.2.4 右下Checklist确认面板 (高度70%)
- **Checklist显示逻辑**:
  - 当前排查问题有checklist字段：按priority降序直接显示所有checklist项目（无需展开）
  - 当前排查问题没有checklist字段：显示"无"

- **视觉设计**:
  - **卡片式布局**: 每个检查项以独立卡片形式展示
  - **颜色区分**: 未排除项目使用白色背景+红色左边框，已排除项目使用灰色背景+灰色边框
  - **删除线效果**: 排除的项目标题添加删除线样式，文字变为灰色

- **交互式确认**:
  - 每个检查项下方固定的两个按钮：
    - **[排除]**: 标记此原因已被排除（排除后按钮禁用，项目变灰+删除线）
    - **[确认]**: 确认此原因存在，执行以下操作：
      - **更新当前节点**: 将该检查项设为当前焦点节点
      - **详情面板更新**: 右上角显示该检查项的详细信息
      - **路径更新**: 左上角导航路径显示完整排查路径
      - **有子checklist**: 在右下方显示该检查项的子checklist
      - **无子checklist**: 直接显示该检查项的解决方案

- **按钮状态管理**:
  - 排除后的项目："排除"按钮禁用（已处理状态）
  - 排除后的项目："确认"按钮禁用（不可再确认）
  - 未排除的项目：两个按钮都可用

- **解决方案输出区域**: 点击[确认]后显示具体的操作步骤和建议

**功能说明**:
- **直观展示**: 所有检查项一目了然，无需点击展开
- **视觉反馈**: 排除效果通过删除线和颜色变化立即体现
- **清晰操作**: 固定的"排除"、"确认"按钮，操作明确
- **逐步排除法排查**：引导用户按优先级逐一排除可能的原因
- **状态跟踪**：通过视觉效果标记已排除的原因，缩小问题范围
- **即时反馈**：按钮点击后立即显示结果或进入下一层级
- **操作指导**：提供具体的解决方案和操作步骤，帮助用户解决问题
- **动态更新**：确认检查项后，右上问题详情会自动更新为该检查项的信息

### 2.3 响应式设计
- **桌面端** (宽度 >= 1200px): 侧边栏 + 主内容区两栏布局
- **平板端** (768px <= 宽度 < 1200px): 侧边栏折叠为顶部导航
- **移动端** (宽度 < 768px): 单列布局，内容区全宽显示

### 2.4 交互方式更新

#### 2.4.1 原GUI组件 → Streamlit组件对应

| 原GUI组件 | Streamlit组件 | 说明 |
|---------|--------------|------|
| 下拉框 | `st.selectbox()` | 问题选择 |
| 复选框 | `st.checkbox()` | 排除标记 |
| 按钮 | `st.button()` | 确认操作 |
| 文本标签 | `st.write()` / `st.markdown()` | 信息展示 |
| 展开器 | `st.expander()` | 详细信息折叠显示 |
| 度量卡片 | `st.metric()` | 数据统计展示 |
| 进度条 | `st.progress()` | 排查进度显示 |

#### 2.4.2 新增Web特性
- **状态消息**: `st.success()` `st.info()` `st.warning()` `st.error()` 操作反馈
- **图表**: `st.bar_chart()` 显示优先级分布
- **数据表格**: `st.dataframe()` 展示结构化排查数据
- **文件上传**: `st.file_uploader()` 支持导入新的yml文件
- **会话状态**: `st.session_state()` 保存用户操作状态

## 3. 交互流程设计

### 3.1 页面访问流程
1. **启动应用** → 自动加载yml数据
2. **选择问题** → 在顶部下拉框选择问题
3. **查看详情** → 右上主内容区显示问题详细信息
4. **确认checklist** → 在右下区域逐项展开确认每个检查项
5. **获取解决方案** → 确认后显示解决方案和操作步骤

### 3.2 用户操作流程

#### 3.2.1 问题选择
```python
# Streamlit代码示例
selected_issue = st.selectbox("📋 选择问题现象", issues)
if selected_issue:
    st.success(f"已选择: {selected_issue}")
```

#### 3.2.2 Checklist确认
```python
# 每个checklist项的展开交互
for item in checklist:
    with st.expander(f"{item.status} (优先级: {item.priority})"):
        col1, col2 = st.columns(2)
        with col1:
            excluded = st.checkbox(f"排除 {item.status}")
        with col2:
            if st.button(f"确认 {item.status}", key=f"confirm_{item.status}"):
                if item.todo:
                    st.success(item.todo)
                else:
                    st.info("需要进一步排查子项")
```

## 4. 数据展示设计

### 4.1 问题详情展示
- **标题区域**: 问题名称 + 优先级标识
- **基本信息**: 描述、版本、引用关系
- **统计信息**: 子项数量、已排查数量、剩余数量

### 4.2 Checklist展示
- **折叠式设计**: 每个checklist项可展开查看详情
- **优先级排序**: 按priority降序显示
- **操作按钮**: 排除和确认按钮
- **状态反馈**: 实时显示操作结果

### 4.3 解决方案展示
- **成功提示**: 绿色成功消息框
- **操作步骤**: 编号列表形式
- **操作指导**: 详细的操作步骤说明

## 5. 用户体验优化

### 5.1 视觉设计
- **图标使用**: 使用emoji图标增强视觉效果
- **颜色编码**: 优先级用不同颜色标识
- **状态指示**: 操作反馈用不同类型消息

### 5.2 交互优化
- **即时反馈**: 操作后立即显示结果
- **错误处理**: 友好的错误提示和解决建议
- **进度跟踪**: 实时显示排查进度

### 5.3 性能优化
- **数据缓存**: 避免重复加载yml文件
- **懒加载**: 大数据量时按需加载
- **状态保存**: 使用session_state保存用户状态

## 6. 功能扩展设计

### 6.1 高级功能
- **批量操作**: 批量排除/确认多个检查项
- **历史记录**: 查看历史排查记录
- **导出报告**: 导出排查结果为PDF/Excel
- **数据可视化**: 排查统计图表

### 6.2 管理功能
- **配置管理**: Web界面配置系统参数
- **文件管理**: 上传/下载yml文件
- **用户管理**: 多用户支持（未来扩展）

这个Web版本的设计保持了原有的功能逻辑，但采用了更现代、更易实现的Streamlit框架，大大降低了开发复杂度，同时提供了清晰的三栏式布局和完整的排查流程。
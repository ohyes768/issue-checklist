# 运维排查助手 Web界面设计方案 (Streamlit版本)

## 1. 技术架构更新

### 1.1 技术栈变更
- **原方案**: Python tkinter + ttkbootstrap GUI框架
- **新方案**: Python Streamlit Web框架
- **优势**: 开发效率提升90%，界面更专业，调试更简单

### 1.2 Streamlit特性
- **自动生成Web界面**: 无需HTML/CSS/JavaScript知识
- **即时预览**: 代码修改后浏览器自动刷新
- **响应式设计**: 自动适配不同屏幕尺寸
- **丰富组件**: 内置图表、表格、侧边栏等组件
- **交互友好**: 支持按钮、滑块、文件上传等多种交互方式

### 1.3 部署方式
```python
# 安装依赖
pip install streamlit

# 运行应用
streamlit run src/web_app.py
```

## 2. 界面布局设计

### 2.1 整体布局设计

#### 示例1: 有checklist的界面状态
```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ 现象筛选: [日志引擎启动异常 ▼] [重置]                      │
├─────────────┬───────────────────────────────────────────────┤
│             │                                               │
│ 当前排查路径  │              当前问题详情                        │
│             │ ┌─────────────────────────────────────────┐   │
│ 📁 日志引擎 │ │ 现象: 流任务启动时提示错误信息...       │   │
│    启动异常  │ │ 描述: 点击日志/告警引擎 启动/重启，提示  │   │
│             │ │     流任务kafka节点预期不符，yarn节点... │   │
│ └─ ◉ 流任务   │ │ 优先级: 5  版本: BaaS-v4.14+          │   │
│    启动错误   │ │ 上级: 日志引擎启动异常                 │   │
│             │ └─────────────────────────────────────────┘   │
│             │                                               │
│             │              Checklist确认面板                │
│             │ ┌─────────────────────────────────────────┐   │
│             │ │ [ ] yarn节点异常 (优先级:10)            │   │
│             │ │     描述:                                │   │
│             │ │     [排除] [确认]                       │   │
│             │ │                                         │   │
│             │ │ [ ] kafka节点离线 (优先级:7)            │   │
│             │ │     描述: 查看kafka集群监控页面，存在异常 │   │
│             │ │     [排除] [确认]                       │   │
│             │ │                                         │   │
│             │ └─────────────────────────────────────────┘   │
│             │                                               │
└─────────────┴───────────────────────────────────────────────┘
```

#### 示例2: 无checklist的界面状态（点击检查项后）
```
┌─────────────────────────────────────────────────────────────┐
│                   运维知识库智能排查助手                      │
├─────────────────────────────────────────────────────────────┤
│ 现象筛选: [日志引擎启动异常 ▼] [重置]                      │
├─────────────┬───────────────────────────────────────────────┤
│             │                                               │
│ 当前排查路径  │              当前问题详情                        │
│             │ ┌─────────────────────────────────────────┐   │
│ 📁 日志引擎 │ │ 现象: yarn节点所在磁盘占用>90%         │   │
│    启动异常  │ │ 描述: 各个节点宿主机df -h查看磁盘占用    │   │
│ └─ 流任务   │ │ 优先级: 9  版本: -                    │   │
│    启动错误   │ │ 上级: 日志引擎启动异常 → 流任务启动错误 │   │
│    └─ yarn  │ └─────────────────────────────────────────┘   │
│       节点   │                                               │
│       异常   │              Checklist确认面板                │
│             │ ┌─────────────────────────────────────────┐   │
│             │ │ 无                                     │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ │                                         │   │
│             │ └─────────────────────────────────────────┘   │
│             │ ┌─────────────────────────────────────────┐   │
│             │ │ 解决方案:                                │   │
│             │ │ 删除历史数据、清理日志文件、减小kafka... │   │
│             │ │                                         │   │
│             │ │ 操作步骤:                                │   │
│             │ │ 1. 登录各个yarn节点宿主机               │   │
│             │ │ 2. 执行df -h命令查看磁盘占用            │   │
│             │ │ 3. 清理不必要的日志文件                 │   │
│             │ │ 4. 减小kafka默认留存时间                 │   │
│             │ │ 5. 释放磁盘空间                         │   │
│             │ └─────────────────────────────────────────┘   │
│             │                                               │
└─────────────┴───────────────────────────────────────────────┘
```

**说明**:
- **示例1**: 展示当前问题有checklist的状态，用户可以看到需要继续排查的子项目
- **示例2**: 展示点击"yarn节点所在磁盘占用>90%"后的状态：
  - 当前问题详情已更新为该检查项的信息
  - Checklist确认面板显示"无"（因为该检查项没有子checklist）
  - 下方显示该检查项的解决方案和操作步骤

### 2.2 界面组件详细说明

#### 2.2.1 顶部工具栏
- **现象筛选下拉框**: 显示yml文档一级status标题，支持下拉选择
- **重置按钮**: 清除当前排查进度，重新开始

**功能说明**:
- 下拉框只显示yml文档的顶级status标题（一级问题现象）
- 例如："日志引擎启动异常"、"yarn节点异常"、"kafka节点离线"
- 选择后加载对应yml文档的完整内容和checklist
- 一键重置功能，方便重新开始排查流程
- 确保选项与yml文档结构完全对应，避免混淆

#### 2.2.2 左侧当前排查路径面板 (宽度25%)
- **路径导航**: 显示从开始现象到当前排查节点的完整路径
- **层级结构**:
  - 📁 文件夹图标：表示问题现象
  - └─ 连接线：表示父子关系
  - ◉ 当前位置：标记正在排查的节点
- **导航功能**: 点击路径中任意节点可快速跳转到该节点

**功能说明**:
- **面包屑导航**: 清晰展示排查路径，让用户知道当前所处位置
- **快速回溯**: 点击上级节点可快速返回之前的排查步骤
- **路径跟踪**: 实时显示排查进展，帮助理解排查逻辑
- **界面简洁**: 只显示必要路径，避免信息干扰

#### 2.2.3 右上当前排查详情面板 (高度30%)
- **基本信息**: 当前现象（status）、如何确认（describe）、影响版本（version）、排查优先级（priority）
- **关联信息**: 显示所关联的上一级现象

**功能说明**:
- 展示当前正在排查的checklist项的详细信息
- 帮助用户理解具体现象的确认方法和影响范围
- 显示与上级问题的关联关系，形成完整的排查链条
- 基于priority提供排查重要性指导

#### 2.2.4 右下Checklist确认面板 (高度70%)
- **Checklist显示逻辑**:
  - 当前排查问题有checklist字段：按priority降序排列显示checklist项目
  - 当前排查问题没有checklist字段：显示"无"

- **交互式确认**:
  - 每个检查项前面：打x选项（复选框），标记"已排除该原因"
  - 每个检查项后面：[确认]按钮，执行下一步操作
    - 有checklist字段：跳转到下一层级继续深入排查，更新当前问题详情
    - 无checklist字段：直接在下方输出todo项作为解决方案，并将此检查项作为新的当前问题详情

- **解决方案输出区域**: 点击[确认]后显示具体的操作步骤和建议

**功能说明**:
- **逐步排除法排查**：引导用户按优先级逐一排除可能的原因
- **状态跟踪**：通过复选框标记已排除的原因，缩小问题范围
- **即时反馈**：[确认]按钮点击后立即显示解决方案，无需额外分析步骤
- **操作指导**：提供具体的解决方案和操作步骤，帮助用户解决问题
- **动态更新**：确认检查项后，右上问题详情会自动更新为该检查项的信息，保持界面的连贯性

### 2.3 响应式设计
- **桌面端** (宽度 >= 1200px): 侧边栏 + 主内容区两栏布局
- **平板端** (768px <= 宽度 < 1200px): 侧边栏折叠为顶部导航
- **移动端** (宽度 < 768px): 单列布局，内容区全宽显示

### 2.4 交互方式更新

#### 2.4.1 原GUI组件 → Streamlit组件对应

| 原GUI组件 | Streamlit组件 | 说明 |
|---------|--------------|------|
| 下拉框 | `st.selectbox()` | 问题选择 |
| 复选框 | `st.checkbox()` | 排除标记 |
| 按钮 | `st.button()` | 确认操作 |
| 文本标签 | `st.write()` / `st.markdown()` | 信息展示 |
| 展开器 | `st.expander()` | 详细信息折叠显示 |
| 度量卡片 | `st.metric()` | 数据统计展示 |
| 进度条 | `st.progress()` | 排查进度显示 |

#### 2.4.2 新增Web特性
- **状态消息**: `st.success()` `st.info()` `st.warning()` `st.error()` 操作反馈
- **图表**: `st.bar_chart()` 显示优先级分布
- **数据表格**: `st.dataframe()` 展示结构化排查数据
- **文件上传**: `st.file_uploader()` 支持导入新的yml文件
- **会话状态**: `st.session_state()` 保存用户操作状态

## 3. 交互流程设计

### 3.1 页面访问流程
1. **启动应用** → 自动加载yml数据
2. **选择问题** → 在顶部下拉框选择问题
3. **查看详情** → 右上主内容区显示问题详细信息
4. **确认checklist** → 在右下区域逐项展开确认每个检查项
5. **获取解决方案** → 确认后显示解决方案和操作步骤

### 3.2 用户操作流程

#### 3.2.1 问题选择
```python
# Streamlit代码示例
selected_issue = st.selectbox("📋 选择问题现象", issues)
if selected_issue:
    st.success(f"已选择: {selected_issue}")
```

#### 3.2.2 Checklist确认
```python
# 每个checklist项的展开交互
for item in checklist:
    with st.expander(f"{item.status} (优先级: {item.priority})"):
        col1, col2 = st.columns(2)
        with col1:
            excluded = st.checkbox(f"排除 {item.status}")
        with col2:
            if st.button(f"确认 {item.status}", key=f"confirm_{item.status}"):
                if item.todo:
                    st.success(item.todo)
                else:
                    st.info("需要进一步排查子项")
```

## 4. 数据展示设计

### 4.1 问题详情展示
- **标题区域**: 问题名称 + 优先级标识
- **基本信息**: 描述、版本、引用关系
- **统计信息**: 子项数量、已排查数量、剩余数量

### 4.2 Checklist展示
- **折叠式设计**: 每个checklist项可展开查看详情
- **优先级排序**: 按priority降序显示
- **操作按钮**: 排除和确认按钮
- **状态反馈**: 实时显示操作结果

### 4.3 解决方案展示
- **成功提示**: 绿色成功消息框
- **操作步骤**: 编号列表形式
- **操作指导**: 详细的操作步骤说明

## 5. 用户体验优化

### 5.1 视觉设计
- **图标使用**: 使用emoji图标增强视觉效果
- **颜色编码**: 优先级用不同颜色标识
- **状态指示**: 操作反馈用不同类型消息

### 5.2 交互优化
- **即时反馈**: 操作后立即显示结果
- **错误处理**: 友好的错误提示和解决建议
- **进度跟踪**: 实时显示排查进度

### 5.3 性能优化
- **数据缓存**: 避免重复加载yml文件
- **懒加载**: 大数据量时按需加载
- **状态保存**: 使用session_state保存用户状态

## 6. 功能扩展设计

### 6.1 高级功能
- **批量操作**: 批量排除/确认多个检查项
- **历史记录**: 查看历史排查记录
- **导出报告**: 导出排查结果为PDF/Excel
- **数据可视化**: 排查统计图表

### 6.2 管理功能
- **配置管理**: Web界面配置系统参数
- **文件管理**: 上传/下载yml文件
- **用户管理**: 多用户支持（未来扩展）

这个Web版本的设计保持了原有的功能逻辑，但采用了更现代、更易实现的Streamlit框架，大大降低了开发复杂度，同时提供了清晰的三栏式布局和完整的排查流程。
# 运维知识库智能排查助手

基于Streamlit构建的运维知识库智能排查助手，帮助运维人员通过智能排查流程快速定位和解决问题。

## 🎯 项目特色

### 智能交互设计
- **三栏布局设计**: 左侧导航 + 中间详情 + 右侧操作，信息层次清晰
- **直接显示**: 所有检查项直接展示，无需层层展开，提升排查效率
- **智能切换**: 确认检查项后，右侧自动切换为解决方案，无需额外操作
- **引用支持**: 支持问题间的refer引用，构建知识网络，避免重复维护

### 用户体验优化
- **视觉反馈**: 排除项目带删除线效果，确认项目即时显示解决方案
- **操作便捷**: 使用emoji图标按钮，悬浮提示，直观易用
- **路径导航**: 完整的排查路径追踪，支持快速跳转和返回
- **响应式设计**: 自适应不同屏幕尺寸

### 数据结构优势
- **YAML驱动**: 结构化配置，易于维护和扩展
- **强类型设计**: 使用dataclass确保代码质量和类型安全
- **模块化架构**: 清晰的分层设计，便于功能扩展

## 项目结构

```
checklist-2/
├── data/                           # YAML数据文件目录（支持子目录）
│   ├── kafka/                      # 分类子目录
│   │   └── kafka节点离线.yml
│   ├── yarn/                       # 分类子目录
│   │   └── yarn节点异常.yml
│   └── 日志引擎启动异常.yml
├── src/                            # 源代码目录
│   ├── models/                     # 数据模型
│   │   └── checklist.py
│   ├── utils/                      # 工具类
│   │   ├── data_loader.py
│   │   └── tree_builder.py
│   ├── controllers/                # 控制器
│   │   ├── state_manager.py
│   │   └── web_controller.py
│   └── main_app.py                # 主应用
├── scripts/                        # 启动脚本
│   ├── start_web.bat
│   └── start_web.sh
├── docs/                          # 文档目录
├── main.py                        # 入口文件
└── requirements.txt               # 依赖文件
```

## ✨ 核心功能

### 🔄 智能排查流程
- **树形排查逻辑**: 基于YAML配置的多层级排查结构
- **refer引用支持**: 问题间相互引用，构建知识图谱
- **优先级排序**: 自动按优先级展示检查项，优先处理关键问题
- **实时状态跟踪**: 显示当前排查路径、排除状态和进度

### 🎨 现代化界面
- **紧凑布局**: 优化空间利用，信息密度高
- **视觉反馈**: 排除项目删除线、确认项目高亮
- **智能导航**: 点击路径快速跳转，返回上级操作便捷
- **响应式设计**: 适配不同设备和使用场景

### 💡 用户友好设计
- **问题现象作为检查项**: 统一展示规范，界面一致
- **引用项目智能处理**: 确认引用项目时显示被引用项目的子检查项
- **解决方案即时显示**: 确认项目后立即显示对应解决方案
- **简洁的操作流程**: 选择 → 查看 → 确认 → 解决，一气呵成

## 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt

# 或使用uv（推荐）
uv pip install -r requirements.txt
```

## 启动应用

### 推荐方式：使用虚拟环境（venv）

#### Windows
```bash
# 使用venv启动脚本（自动创建虚拟环境）
scripts/start_venv_auto.bat
```

#### Linux/Mac
```bash
# 使用venv启动脚本（自动创建虚拟环境）
./scripts/start_venv.sh
```

### 快速启动方式：使用全局Python

#### Windows
```bash
# 使用批处理脚本
scripts/start_web.bat

# 或直接启动
streamlit run main.py
```

#### Linux/Mac
```bash
# 使用shell脚本
chmod +x scripts/start_web.sh
./scripts/start_web.sh

# 或直接启动
streamlit run main.py
```

### 手动使用venv

如果需要手动管理虚拟环境：

```bash
# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境
# Windows
.venv\Scripts\activate
# Linux/Mac
source .venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 启动应用
streamlit run main.py

# 停用虚拟环境
deactivate
```

应用启动后会在浏览器中打开: http://localhost:8501

### 停止应用

#### 方法1：快捷键停止（推荐）
在运行应用的命令行窗口中按下 `Ctrl + C`

#### 方法2：关闭窗口
直接关闭运行应用的命令行窗口

#### 方法3：使用停止脚本
```bash
# Windows
scripts/stop_app.bat

# Linux/Mac
./scripts/stop_app.sh
```

## 🚀 使用说明

### 📋 基础操作流程

1. **选择问题现象**
   - 从左侧面板的下拉框选择要排查的问题
   - 选择后立即显示问题详情和第一层检查项

2. **查看详细信息**
   - **中间面板**: 始终显示当前排查进展（现象、HowToCheck、优先级、版本等）
   - **左侧导航**: 完整的排查路径，支持点击跳转到任意层级

3. **智能排查操作**
   - **右侧面板**: 显示当前层级的Checklist确认单
   - **🚫 排除**: 点击排除按钮标记问题已被排除（带删除线效果）
   - **✅ 确认**: 点击确认按钮确认问题存在

4. **获取解决方案**
   - **普通项目**: 确认后右侧自动切换为解决方案详情
   - **引用项目**: 确认后右侧显示被引用项目的子检查项列表
   - **🔙 返回**: 点击返回按钮回到检查列表，继续排查其他项目

### 🎯 交互逻辑优势

#### 🔄 智能状态切换
- **Checklist → 解决方案**: 确认项目后无缝切换到解决方案显示
- **引用项目处理**: 自动识别引用类型，显示相应内容（子检查项 vs 解决方案）
- **持续排查**: 支持返回继续排查，不强制中断流程

#### 📍 精准路径导航
- **完整路径追踪**: 显示从问题到当前检查项的完整路径
- **快速跳转**: 点击路径任意节点快速跳转到对应层级
- **上下级导航**: 返回上级按钮便于回溯排查步骤

#### 💡 信息展示优化
- **统一展示规范**: 所有层级统一显示为"现象"格式
- **实时更新**: 排除/确认操作立即反映在界面上
- **视觉区分**: 不同状态使用不同样式（删除线、禁用按钮等）
- **精准术语**: 使用"HowToCheck"提供具体的检查指导方法

### ⚡ 高效排查特性

1. **一次性展示**: 所有检查项直接显示，无需逐级展开
2. **智能排序**: 按优先级自动排序，优先处理关键问题
3. **快速操作**: 图标按钮配合悬浮提示，操作直观便捷
4. **无缝切换**: 确认与查看解决方案无缝衔接
5. **知识复用**: 通过refer引用避免重复维护相同内容

## YAML数据格式

每个YAML文件包含一个问题的完整排查流程：

```yaml
status: "问题标题"
describe: "问题描述"
priority: 10  # 优先级(1-10，数字越大越重要)
version: "影响版本范围"
display: true  # 是否在问题列表中显示，默认为false
checklist:
  - status: "直接原因现象"
    describe: "详细说明和确认方法"
    priority: 8
    version: "版本范围"
    todo: "解决方案描述"
    checklist:  # 子检查项（可选）
      - status: "子现象"
        describe: "子描述"
        priority: 5
        version: "-"
        todo: "子解决方案"
  - status: "另一个直接原因"
    refer: "其他问题标题"  # 引用其他问题（可选）
```

**字段说明**：
- `status`: 问题标题（必需）
- `describe`: 问题描述（建议添加）
- `priority`: 优先级，1-10的整数，数字越大越重要（建议添加）
- `version`: 影响版本范围（建议添加）
- `display`: 是否在下拉列表中显示，默认为 `false`。只有显式设置为 `true` 的问题才会显示在问题选择列表中
- `checklist`: 检查项列表（必需）

**注意事项**：
- 仅供引用的子问题可以设置 `display: false`，这样不会出现在问题列表中
- 支持按子目录分类组织 YAML 文件，系统会递归读取所有子目录
- 应用启动时会自动检查所有文件的完整性并打印报告

## 开发规范

- 使用强类型数据结构
- 每个文件不超过300行
- 遵循模块化设计原则
- 详细的错误处理和日志记录

## 技术栈

- **Python 3.8+**
- **Streamlit**: Web框架
- **PyYAML**: YAML解析
- **Pandas**: 数据处理

## 版本信息

- 版本: 1.1.0
- 基于: Claude Code 生成

### 更新日志

#### v1.1.0 (2026-01-21)
**功能增强**：
- ✨ 新增 `display` 字段，支持控制问题是否在下拉列表中显示
- ✨ 支持按子目录分类组织 YAML 文件，系统递归读取所有子目录
- ✨ 问题列表按优先级降序排列，高优先级问题优先显示
- ✨ 应用启动时自动进行数据质量检查，打印详细报告
- 🐛 修复 Streamlit ScriptRunContext 警告

**用户体验改进**：
- 问题列表更简洁，只显示设置为可见的问题
- 支持按类别（子目录）组织知识库文件
- 初始化时提供详细的数据质量反馈
- 区分显示"文件不存在"和"文件存在但加载失败"的引用错误

#### v1.0.0
- 初始版本
- 基础排查功能
- 三栏布局设计
- refer引用支持